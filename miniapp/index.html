<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Панель полётов</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/framer-motion/dist/framer-motion.umd.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/lucide-static@0.279.0/font/lucide.css" rel="stylesheet">
</head>
<body class="bg-gradient-to-br from-sky-100 to-blue-200 min-h-screen flex flex-col items-center p-6">

  <!-- Заголовок -->
  <header class="text-center mb-6">
    <h1 class="text-4xl font-bold text-blue-800 flex items-center justify-center gap-3">
      ✈️ Панель полётов
    </h1>
    <p class="text-gray-600 mt-2">Управление рейсами, ролями и пользователями</p>
  </header>

  <!-- Панель управления -->
  <div class="flex gap-4 mb-6">
    <button onclick="openModal()" class="px-4 py-2 bg-blue-600 text-white rounded-xl shadow-md hover:bg-blue-700 transition flex items-center gap-2">
      <i class="lucide-plus"></i> Добавить рейс
    </button>
    <button onclick="openUserModal()" class="px-4 py-2 bg-green-600 text-white rounded-xl shadow-md hover:bg-green-700 transition flex items-center gap-2">
      <i class="lucide-user-plus"></i> Добавить пользователя
    </button>
    <select id="roleSelect" onchange="changeRole(this.value)" class="px-3 py-2 border rounded-lg shadow-sm">
      <option value="pilot">Пилот</option>
      <option value="manager">Менеджер</option>
      <option value="accountant">Бухгалтер</option>
      <option value="admin">Админ</option>
    </select>
  </div>

  <!-- Таблица -->
  <div class="overflow-x-auto w-full max-w-6xl shadow-lg rounded-2xl bg-white p-4">
    <table class="w-full border-collapse">
      <thead class="bg-blue-600 text-white">
        <tr>
          <th class="p-3 text-left">Дата</th>
          <th class="p-3 text-left">Маршрут</th>
          <th class="p-3 text-left">Статус</th>
          <th class="p-3 text-left">Доход</th>
          <th class="p-3 text-left">Расход</th>
          <th class="p-3 text-left">Комментарий пилота</th>
          <th class="p-3 text-left">Комментарий менеджера</th>
          <th class="p-3 text-left">✏️</th>
        </tr>
      </thead>
      <tbody id="flightsTable" class="divide-y divide-gray-200">
        <!-- Строки будут добавлены JS -->
      </tbody>
    </table>
  </div>

  <!-- Модальное окно для рейсов -->
  <div id="modal" class="fixed inset-0 hidden bg-black bg-opacity-50 flex items-center justify-center">
    <div class="bg-white rounded-2xl shadow-xl p-6 w-96 animate__animated animate__fadeIn">
      <h2 class="text-xl font-semibold mb-4 flex items-center gap-2"><i class="lucide-plane"></i> Рейс</h2>
      <form id="flightForm" class="flex flex-col gap-3">
        <input id="date" placeholder="Дата (YYYY-MM-DD)" class="p-2 border rounded-lg"/>
        <input id="route" placeholder="Маршрут" class="p-2 border rounded-lg"/>
        <input id="status" placeholder="Статус" class="p-2 border rounded-lg"/>
        <input id="income" placeholder="Доход" class="p-2 border rounded-lg"/>
        <input id="expense" placeholder="Расход" class="p-2 border rounded-lg"/>
        <textarea id="pilot_comment" placeholder="Комментарий пилота" class="p-2 border rounded-lg"></textarea>
        <textarea id="manager_comment" placeholder="Комментарий менеджера" class="p-2 border rounded-lg"></textarea>
        <div class="flex justify-end gap-2 mt-3">
          <button type="button" onclick="closeModal()" class="px-3 py-2 bg-gray-300 rounded-lg">Отмена</button>
          <button type="submit" class="px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">Сохранить</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Модальное окно для пользователей -->
  <div id="userModal" class="fixed inset-0 hidden bg-black bg-opacity-50 flex items-center justify-center">
    <div class="bg-white rounded-2xl shadow-xl p-6 w-96 animate__animated animate__fadeIn">
      <h2 class="text-xl font-semibold mb-4 flex items-center gap-2"><i class="lucide-user"></i> Пользователь</h2>
      <form id="userForm" class="flex flex-col gap-3">
        <input id="tg_id" placeholder="Telegram ID" class="p-2 border rounded-lg"/>
        <input id="username" placeholder="Имя пользователя" class="p-2 border rounded-lg"/>
        <select id="role" class="p-2 border rounded-lg">
          <option value="pilot">Пилот</option>
          <option value="manager">Менеджер</option>
          <option value="accountant">Бухгалтер</option>
          <option value="admin">Админ</option>
        </select>
        <div class="flex justify-end gap-2 mt-3">
          <button type="button" onclick="closeUserModal()" class="px-3 py-2 bg-gray-300 rounded-lg">Отмена</button>
          <button type="submit" class="px-3 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">Добавить</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    let currentRole = "pilot";
    function changeRole(role) { currentRole = role; loadFlights(); }
    function openModal() { document.getElementById("modal").classList.remove("hidden"); }
    function closeModal() { document.getElementById("modal").classList.add("hidden"); }
    function openUserModal() { document.getElementById("userModal").classList.remove("hidden"); }
    function closeUserModal() { document.getElementById("userModal").classList.add("hidden"); }

    async function loadFlights() {
      const res = await fetch("/api/flights");
      const flights = await res.json();
      const tbody = document.getElementById("flightsTable");
      tbody.innerHTML = "";
      flights.forEach(f => {
        const tr = document.createElement("tr");
        tr.className = "hover:bg-blue-50 transition";
        tr.innerHTML = `
          <td class="p-2">${f.date || ""}</td>
          <td class="p-2">${f.route || ""}</td>
          <td class="p-2">${f.status || ""}</td>
          <td class="p-2">${f.income || ""}</td>
          <td class="p-2">${f.expense || ""}</td>
          <td class="p-2">${f.pilot_comment || ""}</td>
          <td class="p-2">${f.manager_comment || ""}</td>
          <td class="p-2">
            <button class="text-blue-600 hover:text-blue-800"><i class="lucide-edit"></i></button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    loadFlights();
  </script>
</body>
</html>